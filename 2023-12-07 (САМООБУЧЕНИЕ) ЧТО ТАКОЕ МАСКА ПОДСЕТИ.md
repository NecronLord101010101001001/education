Начало: 
## Что такое подсеть

В одном из значений сеть — это группа устройств под одним управлением, способных коммуницировать между собой. Также сеть означает диапазон IP-адресов — выделенный или полученный от регистратора — для конкретной физической сети. Например, выбранный приватный диапазон 10.0.0.0/8 или полученный от регистратора диапазон внешних адресов 192.0.2.0/24.

Чтобы сети между собой не пересекались, для удобства и разделения доступа, сеть делится на сегменты.

**Подсеть**, помимо меньшего физического сегмента большой сети, также означает диапазон адресов меньшего размера, созданный путем деления более крупной сети на равные непересекающиеся части. Размер подсети определяется маской подсети.

## Что такое IP-адрес

**IP** — Internet Protocol, межсетевой протокол — на модели OSI это протокол третьего сетевого уровня. Его главная задача — адресация узлов сети и маршрутизация пакетов до них. Ключевые сущности для межсетевого протокола: IP-адрес, маска подсети и маршрут.

Теперь к понятию **IP-адреса**. Это уникальный идентификатор устройства (ПК, мобильного телефона, принтера и т.д.) в компьютерной сети, содержащий данные о нем.

## Из чего состоит IP-адрес: IPv4 в двоичной системе и IPv6

### IPv4

В версии протокола IPv4 адрес представляет собой 4-байтовое или 32-битное число. Для удобства можно реализовать перевод IP-адреса в двоичную систему. В таком случае он записывается с разбивкой по октетам в двоично-десятичном представлении — каждое число от 0 до 255 соответствует одному байту в адресе. Самый популярный пример — адрес многих роутеров 192.168.0.1.

### IPv6

В версии IPv6 длина адреса составляет 128 бит, что расширяет возможности адресации. Обычно адрес принимает вид 8 четырехзначных шестнадцатеричных чисел, для упрощения адрес записывают с пропуском начальных нулей. IP-адрес 1050:0000:0000:0000:0005:0600:300c:326b можно записать как 1050:0:0:0:5:600:300c:326b.

Утверждается, что протокол IPv6 может обеспечить до 5·1028 адресов на каждого жителя Земли. Новая версия протокола была введена из-за недостатка адресов IPv4 и для иерархичности адресов, что упрощает маршрутизацию.
### Стек протоколов и сетевая модель TCP/IP

**TCP** — Transmission Control Protocol, протокол контроля передачи — протокол 4 транспортного уровня модели OSI. Его ключевые функции — мониторинг передачи данных, сегментация данных при отправке и сборке пакетов в правильном порядке при получении.

TCP обеспечивает надежную доставку пакетов за счет установления предварительного логического соединения методом «трех рукопожатий», или 3-way handshake, — периодического подтверждения доставки пакетов и переотправки потерянных.

Ключевой сущностью для протокола TCP является порт — 16-битное целое число от 1 до 65535. Данное число позволяет идентифицировать конкретное приложение на узле, отправляющее трафик (порт отправителя) либо принимающее на удаленном узле (порт получателя).

Стек протоколов и сетевая модель **TCP/IP** имеет более упрощенное разделение по уровням, чем сетевая модель OSI, но покрывает все предоставляемые ею функции. Вместо семи уровней OSI стек TCP/IP состоит из четырех:

- уровень приложений — сетевой протокол верхнего уровня, использует HTTP, RTSP, SMTP,
- транспортный уровень — TCP, UDP,
- сетевой уровень — IP,
- канальный уровень — DHCP, ARP.

Для работы с маской подсети стоит отдельно упомянуть прикладной протокол **DHCP** — Dynamic Host Configuration Protocol, протокол динамической конфигурации хоста. Это широковещательный протокол, позволяющий хосту получить настройки IP в автоматическом режиме без необходимости ручной настройки. В настройки входит IP-адрес, маска подсети, основной шлюз, DNS-серверы.

### Что такое маска подсети

**Маска подсети** — 32-битное число, служащее битовой маской для разделения сетевой части (адреса подсети) и части хоста IP-адреса. Состоит из последовательности от 0 до 32 двоичных единиц, после которых остаток разрядов представляют двоичные нули. Их смешение недопустимо. Устройства в одной подсети имеют одинаковый адрес подсети и передают данные на канальном уровне.

Устройства в разных подсетях коммуницируют через маршрутизацию. Как и IP-адрес, маска может быть записана в двоично-десятичной форме (например, 255.255.0.0) или в виде префикса в CIDR-нотации — числом от 0 до 32, обозначающего длину маски в битах. Например, в подсети 192.0.2.0/24 значение /24 — это маска, равная 255.255.255.0.

### Маршрутизатор и основной шлюз подсети

Пересылку пакетов данных между разными IP-сетями осуществляет **маршрутизатор, или роутер,** — устройство, представляющее собой компьютер с несколькими сетевыми интерфейсами, на котором установлено специальное ПО для маршрутизации.

**Маршрут** — запись в таблице маршрутизации о следующем устройстве в сети (адрес машины или сетевой интерфейс), которому следует направить пакеты для пересылки в конечную сеть.

Таблица маршрутизации хранится в памяти роутера, ее главная функция — описание соответствия между адресами назначения и интерфейсами, через которые необходимо отправить данные до следующего маршрутизатора.

**Основной шлюз** — устройство или специальная ОС, которые обеспечивают коммуникацию сетей. Сейчас TCP/IP — самый популярный стек, и шлюз фактически стал синонимом маршрутизатора. Шлюз по умолчанию — маршрут до подсетей, не имеющих в таблице маршрутизации специфического маршрута.

При наличии двух маршрутов с разной маской для одного IP-адреса выбирается более специфический маршрут — с самой длинной маской, то есть в самую меньшую подсеть из доступных.

### Адресный план

**Составление адресного плана** — это разбиение IP-пространства на подсети одинакового размера. Процесс необходим для повышения безопасности и производительности. Например, предприятию необходимо разграничить работу отделов: в каждой подсети будут определенные устройства — HR-отдел не получит доступ к подсети финансистов, но у всех будет разрешение на доступ к серверам.м

Маска подсети позволяет вычислить, кто находится в одной подсети. Компьютеры подсети обмениваются данными напрямую, а запрос на выход в интернет идет через шлюз по умолчанию.

### Агрегация

**Агрегация** — процесс объединения мелких префиксов с длинной маской и малым количеством хостов в крупные — с короткой маской и множеством хостов. С помощью агрегации минимизируется необходимая информация для маршрутизатора, которую он использует для поиска пути передачи в сети.

### Классовая адресация

**Классовая адресация** — архитектура сетевой адресации, которая делит адресное пространство протокола IPv4 на пять классов адресов: A для больших сетей, B для средних, C для небольших, D и E — служебные сети.

Принадлежность к одному из классов задается первыми битами адреса. Класс определяет количество возможных адресов хостов внутри сети. Модель классовой адресации использовали до появления CIDR.

### Бесклассовая адресация

**CIDR** — Classless InterDomain Routing, бесклассовая междоменная маршрутизация. Это метод адресации, который позволяет гибко управлять пространством IP-адресов за счет отсутствия жестких рамок предыдущей модели.

**VLSM** — Variable Length Subnet Mask, переменная длина маски подсети — ключевая сущность бесклассовой адресации. При CIDR маска может быть любой длины от 0 до 32 бит, тогда как в случае классовой адресации маске подсети давалось фиксированное значение в зависимости от класса: 8, 16 или 24 бит.

VLSM повышает удобство использования подсетей, поскольку они могут быть разного размера. Допустим, администратору нужно управлять четырьмя отделами с определенным количеством компьютеров: продажи и закупки (120 компьютеров), разработка (50), аккаунты (26) и отдел управления (5).

IP администратора 192.168.1.0/24. Для каждого сегмента производится расчет размера блока, который больше или равен фактической потребности, представляющей собой сумму адресов хостов, широковещательных адресов и сетевых адресов. Список возможных подсетей:

|   |   |
|---|---|
|**Обозначение**|**Хосты/подсети**|
|/24|254|
|/25|126|
|/26|62|
|/27|30|
|/28|14|
|/29|6|
|/30|2|

Все сегменты располагаются в порядке убывания на основе размера блока от наибольшего до наименьшего требования.

Наибольший доступный IP должен быть выделен для самых больших потребностей, то есть для самого большого количества ПК. У отдела продаж и закупок — 120 ПК. Он получает 192.168.1.0/25, который имеет 126 действительных адресов, легко доступные для 120 хостов. Используемая маска подсети 255.255.255.128.

Следующий сегмент — отдел разработки — требует IP для обслуживания 50 хостов. IP-подсеть с сетевым номером 192.168.1.128/26 является следующей по величине, которая может быть назначена для 62 хостов, таким образом выполняя требование отдела. Маска будет иметь значение 255.255.255.192.

Аналогично следующая IP подсеть 192.168.1.192/27 может удовлетворить требования аккаунт-отдела, так как она имеет 30 действительных IP-хостов, которые могут быть назначены 26 компьютерам. Используемая маска подсети 255.255.255.224.

Последний сегмент требует 5 действительных хостов IP, которые могут быть выполнены подсетью 192.168.1.224/29 с маской 255.255.255.248. Можно было бы выбрать IP с маской 255.255.255.240, но он имеет 14 действительных хостов IP. Поскольку требования меньше — выбирается наиболее сопоставимый вариант.

## Будущее IP-адресов — архитектура RINA

Если вы решите использовать подсети, маски будут необходимы для обеспечения того, чтобы входящий трафик направлялся к нужным хост-устройствам и от них. Даже если у вас относительно небольшая система, маски подсети могут сыграть важную роль в ее надежной и бесперебойной работе.

Возможная технология будущего для IP-адресов — Recursive InterNetwork Architecture. RINA — новая сетевая архитектура, основанная на фундаментальном принципе, что сетевое взаимодействие — это межпроцессное взаимодействие (IPC). Она рекурсирует службу IPC в различных диапазонах.

Архитектура RINA обладает свойствами, которые по своей сути решают давние проблемы сетевого взаимодействия. Прежде всего, повторяющаяся структура ее модели распределенного IPC позволяет ей неограниченно масштабироваться, что позволяет избежать текущих проблем с растущими таблицами маршрутизации. Кроме того, RINA рассматривает каждый DIF как частную сеть, что обеспечивает внутреннюю безопасность.